---
name: task-008-tui-preview-selection
title: Implement TUI file preview and selection
epic: phase-2-enhanced-ux
github_issue: null
status: open
size: M
estimated_hours: 16
parallel: true
depends_on: [21]
created: 2026-01-21T05:26:54Z
updated: 2026-01-26T00:52:32Z
labels: [task, tui, ui]
github: https://github.com/curdriceaurora/Local-File-Organizer/issues/190
---

# Task 008: Implement TUI file preview and selection

**Epic:** Phase 2 - Enhanced User Experience
**Status:** Open
**Size:** M (16 hours)
**Parallel Execution:** Yes
**Dependencies:** Task 006

## Objective
Implement file preview functionality and selection system in the TUI, allowing users to view file contents before organizing and select multiple files for batch operations.

## Description
Create a preview pane that displays file contents, metadata, and thumbnails for various file types. Implement a robust multi-select system allowing users to select/deselect files individually or in bulk for organization operations.

## Requirements

### Functional Requirements

1. **File Preview Pane**
   - Text files: Display content with syntax highlighting
   - Images: Show ASCII art or image metadata
   - PDFs: Display metadata and first page text
   - Audio: Show metadata (artist, album, duration)
   - Video: Show metadata (resolution, duration, codec)
   - Archives: List contents
   - Unknown types: Show file info only

2. **Preview Features**
   - Auto-refresh on navigation
   - Scrollable preview for long content
   - Character encoding detection
   - Binary file detection
   - Size limits (preview max 1MB of text)
   - Error handling for corrupted files

3. **File Selection**
   - Space bar to toggle selection
   - Visual indicators (checkboxes, highlighting)
   - Select all in current folder (Ctrl+A)
   - Deselect all (Ctrl+D)
   - Invert selection (Ctrl+I)
   - Select by pattern (Ctrl+P)
   - Remember selection across navigation

4. **Selection Management**
   - Display selection count in status bar
   - Show selected files list
   - Clear selection option
   - Export selection to file
   - Load selection from file

### Technical Requirements
1. Use appropriate libraries for file type detection
2. Implement async preview loading (non-blocking)
3. Cache preview data for performance
4. Handle large files gracefully
5. Support multiple file encodings (UTF-8, Latin-1, etc.)

### UI Layout
```
â”Œâ”€ File Organizer TUI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser â”‚ Preview                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ“ Work â”‚ File: report.pdf                     â”‚
â”‚ â˜‘ reportâ”‚ Size: 2.3 MB                         â”‚
â”‚ â˜ data  â”‚ Modified: 2026-01-15                 â”‚
â”‚ â˜‘ notes â”‚ Type: PDF Document                   â”‚
â”‚         â”‚                                      â”‚
â”‚         â”‚ --- Content Preview ---              â”‚
â”‚         â”‚ Title: Q4 Financial Report           â”‚
â”‚         â”‚ Author: John Doe                     â”‚
â”‚         â”‚ Pages: 25                            â”‚
â”‚         â”‚                                      â”‚
â”‚         â”‚ [Preview of first page text...]      â”‚
â”‚         â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Selected: 2 files (3.1 MB) | Space=Select      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Implementation Steps

1. **File Type Detection** (2 hours)
   - Implement magic number detection
   - Add MIME type detection
   - Create file type registry
   - Handle edge cases (extensionless files)

2. **Preview Renderers** (6 hours)
   - Text preview with encoding detection
   - Image metadata extractor
   - PDF metadata reader
   - Audio/video metadata reader
   - Archive contents lister
   - Binary file handler
   - Syntax highlighting for code files

3. **Preview Pane Widget** (3 hours)
   - Create scrollable preview container
   - Implement async loading with spinner
   - Add error handling and fallbacks
   - Implement preview caching
   - Add refresh on file change

4. **Selection System** (4 hours)
   - Track selection state
   - Implement toggle, select all, deselect all
   - Add visual indicators (checkboxes)
   - Implement pattern-based selection
   - Persist selection across navigation
   - Add selection statistics

5. **Testing and Polish** (1 hour)
   - Test with various file types
   - Verify memory usage with large files
   - Test selection operations
   - Handle corrupted files gracefully

## Acceptance Criteria
- [ ] Preview displays correct content for all supported file types
- [ ] Text files display with proper encoding
- [ ] Images show metadata or ASCII representation
- [ ] Preview loads asynchronously without blocking UI
- [ ] Large files (>1MB) show truncated preview
- [ ] Selection works with all keyboard shortcuts
- [ ] Selected files persist during navigation
- [ ] Selection count displays accurately
- [ ] Corrupted files show error message instead of crashing
- [ ] Preview pane is scrollable for long content

## Test Cases

### Test Case 1: Text File Preview
```python
def test_text_preview():
    # Load text file
    # Verify encoding detected correctly
    # Check content displayed
    # Test scrolling
    # Verify syntax highlighting for code
```

### Test Case 2: Multi-file Selection
```python
def test_file_selection():
    # Select file with Space
    # Navigate to another file
    # Verify first file still selected
    # Select multiple files
    # Check selection count
    # Deselect all
    # Verify count is zero
```

### Test Case 3: Binary File Handling
```python
def test_binary_preview():
    # Load binary file (exe, dll)
    # Verify metadata shown
    # Check no attempt to display content
    # Verify no errors or crashes
```

### Test Case 4: Large File Performance
```python
def test_large_file_preview():
    # Load file >10MB
    # Verify preview loads quickly (<1 sec)
    # Check only first portion displayed
    # Verify memory usage is reasonable
```

## Dependencies
- Task 006: Textual TUI framework setup
- Textual 0.50+
- python-magic (file type detection)
- Pillow (image metadata)
- PyPDF2 (PDF metadata)
- mutagen (audio metadata)
- Pygments (syntax highlighting)

## Files to Create/Modify
- `file_organizer_v2/src/file_organizer/tui/widgets/preview_pane.py` - Preview widget
- `file_organizer_v2/src/file_organizer/tui/preview/` - Preview renderers package
  - `text_preview.py` - Text file previews
  - `image_preview.py` - Image metadata
  - `document_preview.py` - PDF/DOC metadata
  - `media_preview.py` - Audio/video metadata
  - `archive_preview.py` - Archive contents
- `file_organizer_v2/src/file_organizer/tui/selection.py` - Selection manager
- `file_organizer_v2/tests/tui/test_preview.py` - Preview tests
- `file_organizer_v2/tests/tui/test_selection.py` - Selection tests

## Reference Materials
- python-magic: https://github.com/ahupp/python-magic
- PyPDF2: https://pypdf2.readthedocs.io/
- Pillow: https://pillow.readthedocs.io/
- Mutagen: https://mutagen.readthedocs.io/
- Pygments: https://pygments.org/

## Notes
- Consider adding preview customization in config (max size, syntax theme)
- Future enhancement: thumbnail generation for images/videos
- Consider adding preview export functionality
- May need to handle platform-specific file associations
- Security consideration: sanitize preview content to prevent code injection
