---
name: task-009-tui-live-preview
title: Add TUI live organization preview
epic: phase-2-enhanced-ux
github_issue: null
status: open
size: M
estimated_hours: 16
parallel: false
depends_on: [24, 27]
created: 2026-01-21T05:26:54Z
updated: 2026-01-21T05:35:26Z
labels: [task, tui, ui, core-feature]
---

# Task 009: Add TUI live organization preview

**Epic:** Phase 2 - Enhanced User Experience
**Status:** Open
**Size:** M (16 hours)
**Parallel Execution:** No
**Dependencies:** Tasks 007, 008

## Objective
Implement a live preview system that shows users how their files will be organized before applying changes, with an intuitive before/after comparison and confirmation workflow.

## Description
Create an interactive preview mode that displays the proposed file organization changes in real-time. Users can see the current file structure alongside the proposed organization, review individual changes, and confirm or reject the operation before any files are moved.

## Requirements

### Functional Requirements

1. **Before/After Comparison View**
   - Split-pane view showing current vs. proposed structure
   - Side-by-side directory trees
   - Highlight differences and changes
   - Show file movements with visual indicators
   - Display organization reasoning for each change

2. **Live Preview Generation**
   - Run organization analysis in background
   - Show progress indicator during analysis
   - Update preview as analysis completes
   - Support cancellation of analysis
   - Handle errors gracefully

3. **Change Review**
   - List all proposed changes
   - Show source â†’ destination for each file
   - Display AI reasoning for each decision
   - Filter changes by type (move, rename, categorize)
   - Search changes by filename
   - Expand/collapse change details

4. **Confirmation Workflow**
   - Clear confirm/cancel options
   - Option to exclude specific changes
   - Bulk actions (accept all, reject all)
   - Save organization plan for later
   - Dry-run mode (simulate without moving)

5. **Statistics Display**
   - Total files to organize
   - Files by category/destination
   - Estimated time for operation
   - Storage space impact
   - Confidence scores per decision

### Technical Requirements
1. Integrate with existing organization engine
2. Non-blocking preview generation
3. Efficient diff computation
4. Support undo/rollback after confirmation
5. Preserve file metadata during preview

### UI Layout
```
â”Œâ”€ Organization Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Analyzing: 127 files... [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Current Structure   â”‚ Proposed Organization               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Downloads        â”‚ ğŸ“ Downloads                         â”‚
â”‚   ğŸ“„ report.pdf     â”‚   ğŸ“ Documents/Reports               â”‚
â”‚   ğŸ“„ invoice.pdf    â”‚     ğŸ“„ report.pdf â† (moved)          â”‚
â”‚   ğŸ“„ photo.jpg      â”‚   ğŸ“ Documents/Invoices              â”‚
â”‚   ğŸµ song.mp3       â”‚     ğŸ“„ invoice.pdf â† (moved)         â”‚
â”‚   ğŸ“„ data.xlsx      â”‚   ğŸ“ Images/Photos                   â”‚
â”‚                     â”‚     ğŸ“„ photo.jpg â† (moved)           â”‚
â”‚                     â”‚   ğŸ“ Music                           â”‚
â”‚                     â”‚     ğŸµ song.mp3 â† (moved)            â”‚
â”‚                     â”‚   ğŸ“ Data                            â”‚
â”‚                     â”‚     ğŸ“„ data.xlsx â† (moved)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Changes: 5 files to organize                              â”‚
â”‚ âœ“ Documents: 2 | Images: 1 | Music: 1 | Data: 1          â”‚
â”‚                                                            â”‚
â”‚ [A]pply Changes  [E]xclude Items  [S]ave Plan  [C]ancel  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ Change Details â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ report.pdf                                                 â”‚
â”‚ From: Downloads/                                           â”‚
â”‚ To:   Downloads/Documents/Reports/                         â”‚
â”‚ Reason: PDF document containing financial report content   â”‚
â”‚ Confidence: 95%                                            â”‚
â”‚                                                            â”‚
â”‚ [âœ“] Include in organization    [View File]  [Next]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Implementation Steps

1. **Preview Engine Integration** (4 hours)
   - Connect to file organization service
   - Implement async preview generation
   - Create preview data model
   - Handle partial results during analysis
   - Add cancellation support

2. **Before/After View Widget** (4 hours)
   - Create split-pane layout
   - Implement synchronized scrolling
   - Add diff highlighting
   - Show movement indicators (arrows)
   - Display organization hierarchy

3. **Change Review System** (3 hours)
   - Create changes list widget
   - Implement change filtering/searching
   - Add detail view for each change
   - Show AI reasoning and confidence
   - Support individual change exclusion

4. **Confirmation Workflow** (3 hours)
   - Build confirmation dialog
   - Implement apply/cancel actions
   - Add progress bar for organization
   - Create save/load plan functionality
   - Implement dry-run mode

5. **Statistics and Polish** (2 hours)
   - Add statistics panel
   - Implement real-time preview updates
   - Add keyboard shortcuts
   - Error handling and recovery
   - User feedback messages

## Acceptance Criteria
- [ ] Preview shows accurate before/after comparison
- [ ] All file movements are clearly indicated
- [ ] AI reasoning is displayed for each decision
- [ ] Users can exclude individual changes
- [ ] Confirmation workflow is clear and intuitive
- [ ] Progress indicator shows during analysis
- [ ] Preview generation doesn't block UI
- [ ] Statistics are accurate and helpful
- [ ] Can cancel preview generation
- [ ] Organization plan can be saved and loaded
- [ ] Dry-run mode works without moving files
- [ ] Undo/rollback available after applying changes

## Test Cases

### Test Case 1: Preview Generation
```python
def test_preview_generation():
    # Select files for organization
    # Trigger preview
    # Verify progress indicator shows
    # Wait for preview to complete
    # Assert before/after trees are correct
    # Check all changes are listed
```

### Test Case 2: Change Exclusion
```python
def test_exclude_changes():
    # Generate preview with 10 changes
    # Exclude 3 specific changes
    # Apply organization
    # Verify only 7 files were moved
    # Check excluded files remain in place
```

### Test Case 3: Confirmation Workflow
```python
def test_confirmation_workflow():
    # Generate preview
    # Review changes
    # Confirm application
    # Verify progress shown
    # Check all files moved correctly
    # Verify metadata preserved
```

### Test Case 4: Cancellation
```python
def test_preview_cancellation():
    # Start preview generation
    # Cancel mid-analysis
    # Verify process stops
    # Check no partial results applied
    # UI returns to normal state
```

### Test Case 5: Save/Load Plan
```python
def test_save_load_plan():
    # Generate preview
    # Save organization plan
    # Close preview
    # Load plan later
    # Verify all changes restored
    # Apply loaded plan successfully
```

## Dependencies
- Task 007: File browser functionality
- Task 008: File preview and selection
- Task 006: TUI framework setup
- Existing organization engine from Phase 1
- Textual 0.50+

## Files to Create/Modify
- `file_organizer_v2/src/file_organizer/tui/preview/` - Preview system package
  - `preview_engine.py` - Preview generation logic
  - `comparison_view.py` - Before/after widget
  - `changes_view.py` - Change list and details
  - `confirmation.py` - Confirmation workflow
- `file_organizer_v2/src/file_organizer/tui/widgets/split_pane.py` - Split view widget
- `file_organizer_v2/src/file_organizer/tui/diff.py` - Diff computation
- `file_organizer_v2/src/file_organizer/tui/plan.py` - Plan save/load
- `file_organizer_v2/tests/tui/test_preview_engine.py` - Preview tests
- `file_organizer_v2/tests/tui/test_confirmation.py` - Workflow tests

## Integration Points
- File organization service (from Phase 1)
- File browser (Task 007)
- Selection system (Task 008)
- Configuration system (for saving plans)
- Undo system (for rollback functionality)

## Reference Materials
- Textual Layout Documentation: https://textual.textualize.io/guide/layout/
- Textual Screens: https://textual.textualize.io/guide/screens/
- Python asyncio: https://docs.python.org/3/library/asyncio.html

## Notes
- Consider adding keyboard shortcuts for power users
- Preview should work even with slow AI models
- May need to throttle preview updates for large file sets
- Consider adding "favorite" organization patterns
- Future enhancement: ML confidence visualization
- Security: validate paths before moving files
- Performance: cache preview results for repeated operations
- UX: provide clear feedback during long operations

## Risk Mitigation
- **Large file sets**: Implement pagination or lazy loading
- **Slow AI models**: Show partial results as they complete
- **File system errors**: Comprehensive error handling with rollback
- **User confusion**: Clear labeling and help text throughout
