---
name: 004-preference-tracking-system
title: Build preference tracking system
status: open
size: M
hours: 16
parallel: true
depends_on: []
created: 2026-01-21T05:53:07Z
updated: 2026-01-26T00:52:32Z
github: https://github.com/curdriceaurora/Local-File-Organizer/issues/219
---

# Task 004: Build preference tracking system

## Description
Build a comprehensive preference tracking system that learns from user corrections and changes. Track user behavior and store preferences in a structured JSON format with per-directory learning capabilities and conflict resolution mechanisms.

## Objectives
- Track user corrections and changes to file organization decisions
- Store preferences in JSON format with clear schema
- Implement per-directory preference learning
- Add preference conflict resolution logic

## Requirements

### Functional Requirements
1. **Correction Tracking**
   - Capture when users move files after initial organization
   - Record manual folder structure changes
   - Track file naming pattern corrections
   - Log category override decisions

2. **Preference Storage**
   - JSON-based preference store with versioning
   - Per-user and per-directory scoping
   - Timestamp tracking for preference evolution
   - Metadata about confidence and frequency

3. **Directory-Level Learning**
   - Separate preferences for different directory contexts
   - Inheritance from parent directories
   - Override capabilities for specific subdirectories
   - Context-aware preference application

4. **Conflict Resolution**
   - Handle contradictory preferences
   - Implement recency-weighted decisions
   - Frequency-based preference prioritization
   - User notification for ambiguous cases

### Technical Requirements
- Python data structures for in-memory preference management
- JSON serialization/deserialization
- File-based persistence with atomic writes
- Thread-safe preference access
- Preference validation and schema enforcement

## Implementation Details

### Preference Schema
```json
{
  "version": "1.0",
  "user_id": "default",
  "global_preferences": {},
  "directory_preferences": {
    "/path/to/dir": {
      "folder_mappings": {},
      "naming_patterns": {},
      "category_overrides": {},
      "created": "2026-01-21T05:53:07Z",
      "updated": "2026-01-21T05:53:07Z",
      "confidence": 0.85
    }
  }
}
```

### Key Components
1. **PreferenceTracker** class
   - track_correction(source, destination, context)
   - get_preference(file_path, preference_type)
   - save_preferences()
   - load_preferences()

2. **PreferenceStore** class
   - add_preference(path, preference_data)
   - get_preference(path, fallback_to_parent)
   - resolve_conflicts(preference_list)
   - update_confidence(path, success)

3. **ConflictResolver** class
   - resolve(conflicting_preferences)
   - weight_by_recency()
   - weight_by_frequency()
   - score_confidence()

## Acceptance Criteria
- [ ] Preference tracking captures all user corrections
- [ ] JSON storage format is well-defined and versioned
- [ ] Per-directory preferences work with inheritance
- [ ] Conflict resolution produces deterministic results
- [ ] Preferences persist across application restarts
- [ ] Thread-safe operations with concurrent access
- [ ] Unit tests cover all preference scenarios
- [ ] Performance: lookup < 10ms for typical cases

## Dependencies
None - This is a foundational task

## Estimated Effort
- Size: M (Medium)
- Hours: 16
- Can be parallelized: Yes

## Testing Strategy
1. Unit tests for PreferenceTracker class
2. JSON schema validation tests
3. Conflict resolution scenario tests
4. Directory inheritance tests
5. Concurrent access tests
6. Performance benchmarks

## Notes
- This is a foundational component for the intelligence system
- Design should support future machine learning integration
- Consider privacy implications of preference storage
- Ensure preferences are human-readable for debugging
