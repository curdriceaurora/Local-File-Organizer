---
name: add-backup-manifest-locking
title: Add file locking for backup manifest to prevent race conditions
status: open
created: 2026-01-21T09:18:28Z
updated: 2026-01-21T09:22:45Z
size: M
hours: 6
parallel: false
dependencies: []
---

# Issue #75: Add file locking for backup manifest

## Description

The backup manifest access lacks file locking, creating race conditions when multiple processes access the manifest simultaneously.

## Current Problem

- Race condition: Two processes can read manifest simultaneously
- One process's updates overwrite the other's changes
- Corrupt manifest possible if interrupted during write
- No atomic read-modify-write guarantee
- Especially problematic with parallel deduplication

## Proposed Solution

Integrate cross-platform file locking using portalocker:
- Add portalocker dependency to pyproject.toml
- Implement file locking for all manifest access
- Handle lock timeout gracefully
- Works on Windows, Linux, macOS

## Acceptance Criteria

- [ ] Add portalocker dependency to pyproject.toml
- [ ] Implement file locking for all manifest access
- [ ] Handle lock timeout gracefully
- [ ] Tests for concurrent access scenarios
- [ ] Works on Windows, Linux, macOS
- [ ] Documentation on concurrent backup usage

## Technical Details

**File**: `src/file_organizer/services/deduplication/backup.py` (lines 35-53)
**Priority**: High (data integrity issue)
**Library**: https://pypi.org/project/portalocker/

## References

- CodeRabbit PR #67 review comment
