---
name: implement-audio-metadata-extraction
title: Implement audio metadata extraction
status: closed
size: M
hours: 16
parallel: true
depends_on: []
created: 2026-01-21T05:39:23Z
updated: 2026-01-24T06:51:14Z
---

# Task 002: Implement audio metadata extraction

## Description

Implement comprehensive audio metadata extraction to capture information embedded in audio files. This includes music metadata (artist, album, genre), technical properties (duration, bitrate, codec), and support for various metadata formats like ID3 tags, Vorbis comments, and MP4 metadata.

## Acceptance Criteria

- [ ] Extract music metadata: artist, album, title, genre, year, track number
- [ ] Extract technical metadata: duration, bitrate, sample rate, channels, codec
- [ ] Support ID3v1, ID3v2.3, and ID3v2.4 tags (MP3)
- [ ] Support Vorbis comments (OGG, FLAC)
- [ ] Support MP4/M4A metadata atoms
- [ ] Handle missing or corrupted metadata gracefully
- [ ] Extract embedded album art/cover images
- [ ] Support multiple artists and genres
- [ ] Handle special characters and Unicode in metadata
- [ ] Return structured metadata object with consistent schema
- [ ] Unit tests for all metadata formats
- [ ] Performance optimized for batch processing

## Technical Details

### Implementation Approach

1. **Metadata Extraction Library**
   - Use mutagen library for comprehensive format support
   - Implement fallback to tinytag for lightweight parsing
   - Handle format-specific edge cases

2. **Metadata Schema**
   - Define unified AudioMetadata data class
   - Map format-specific fields to common schema
   - Handle optional/missing fields gracefully
   - Support custom/extended metadata fields

3. **Format-Specific Handling**
   - **MP3/ID3**: Use mutagen.id3 for complete tag support
   - **FLAC**: Extract Vorbis comments and FLAC-specific fields
   - **M4A/MP4**: Parse atom structure for iTunes metadata
   - **OGG**: Extract Vorbis comments
   - **WAV**: Handle RIFF INFO tags and BWF metadata

4. **Album Art Extraction**
   - Extract embedded images from all formats
   - Convert to standard format (JPEG/PNG)
   - Save with appropriate naming convention
   - Handle multiple images (front cover, back cover, etc.)

5. **Data Validation**
   - Validate metadata completeness
   - Detect and flag suspicious/corrupted data
   - Normalize date formats (YYYY, YYYY-MM-DD)
   - Clean up malformed text encoding

### File Structure
```
file_organizer_v2/src/file_organizer/
├── models/
│   ├── audio_metadata_extractor.py  # Main metadata extraction
│   └── audio_metadata_schema.py     # Data classes
├── services/
│   └── audio_metadata_service.py    # Service layer
└── utils/
    └── metadata_utils.py             # Helper functions
```

### Key Classes

```python
@dataclass
class AudioMetadata:
    """Unified audio metadata schema"""
    # Music metadata
    title: Optional[str] = None
    artist: Optional[str] = None
    album: Optional[str] = None
    album_artist: Optional[str] = None
    genre: Optional[List[str]] = None
    year: Optional[int] = None
    track_number: Optional[int] = None
    disc_number: Optional[int] = None

    # Technical metadata
    duration: float = 0.0  # seconds
    bitrate: int = 0  # kbps
    sample_rate: int = 0  # Hz
    channels: int = 0
    codec: str = ""
    file_format: str = ""

    # Additional
    comment: Optional[str] = None
    composer: Optional[str] = None
    copyright: Optional[str] = None
    album_art: Optional[bytes] = None

    # File info
    file_path: str = ""
    file_size: int = 0  # bytes
    last_modified: Optional[datetime] = None


class AudioMetadataExtractor:
    """Extract metadata from audio files"""

    def extract(self, file_path: str) -> AudioMetadata:
        """Extract all metadata from audio file"""

    def extract_album_art(self, file_path: str) -> Optional[bytes]:
        """Extract album art as bytes"""

    def get_format_info(self, file_path: str) -> Dict[str, Any]:
        """Get technical format information"""
```

### Dependencies
- mutagen >= 1.47.0 (comprehensive metadata library)
- tinytag >= 1.10.0 (lightweight fallback)
- Pillow (for image processing if needed)

### Performance Considerations
- Cache metadata for frequently accessed files
- Use lightweight parser for quick scans
- Batch process files when possible
- Limit album art size extraction
- Set timeout for corrupted files

### Error Handling
- Handle unsupported formats gracefully
- Detect and report corrupted metadata
- Provide partial results when possible
- Log extraction failures with details

## Dependencies

None - this task can be developed in parallel with task 001.

## Effort Estimate

**Size:** Medium (M)
**Estimated Hours:** 16 hours

### Breakdown:
- Metadata extraction setup: 2 hours
- ID3 tag support (MP3): 3 hours
- Vorbis comments (OGG/FLAC): 2 hours
- MP4/M4A metadata: 2 hours
- Album art extraction: 2 hours
- Data validation and normalization: 2 hours
- Testing and edge cases: 3 hours

## Definition of Done

- [ ] Code implemented and follows project style guidelines
- [ ] All acceptance criteria met
- [ ] Unit tests written and passing (>80% coverage)
- [ ] Integration tests with real audio files in various formats
- [ ] Successfully extracts metadata from all supported formats
- [ ] Handles corrupted/missing metadata gracefully
- [ ] Album art extraction working for common formats
- [ ] Performance tested with large batches of files
- [ ] Error handling comprehensive and tested
- [ ] Code reviewed and approved
- [ ] Documentation with usage examples
- [ ] No regression in existing functionality
