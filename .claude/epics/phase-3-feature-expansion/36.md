---
name: enhance-video-metadata-extraction
title: Enhance video metadata extraction
epic: phase-3-feature-expansion
github_issue: null
status: open
size: M
estimated_hours: 16
parallel: true
depends_on: [45]
created: 2026-01-21T05:39:23Z
updated: 2026-01-21T05:45:29Z
---

# Task 006: Enhance video metadata extraction

## Description
Implement comprehensive video metadata extraction including technical specifications (resolution, duration, codec, bitrate) and quality indicators. Use scene-based information from Task 004 to enable intelligent scene-based categorization for better video organization.

## Objectives
- Extract technical video metadata (resolution, duration, codec, bitrate, fps)
- Generate video quality indicators (HD/4K classification, encoding quality)
- Implement scene-based categorization using AI analysis
- Store metadata in structured format for search and organization

## Technical Approach

### Technical Metadata Extraction
- Use ffprobe (ffmpeg-python) for comprehensive video properties
- Extract video streams, audio streams, container format
- Calculate derived metrics (aspect ratio, total frames, file size per minute)

### Quality Indicators
- Classify resolution tier (SD/HD/Full HD/4K/8K)
- Assess encoding quality (bitrate vs resolution analysis)
- Detect compression artifacts or quality issues
- Generate quality score for organization prioritization

### Scene-Based Categorization
- Use scene frames from Task 004 with vision model
- Generate per-scene descriptions and tags
- Aggregate scene information for overall video categorization
- Identify video type (presentation, movie, tutorial, etc.)

## Implementation Details

### Required Libraries
```python
# metadata extraction
import ffmpeg
from pathlib import Path
import json

# quality analysis
import numpy as np
from PIL import Image

# scene categorization
from transformers import pipeline
```

### Core Components
1. **VideoMetadataExtractor** - Extract technical video properties
2. **QualityAnalyzer** - Assess video quality and generate indicators
3. **SceneCategorizer** - Analyze scenes for content-based categorization
4. **MetadataStorage** - Store and index video metadata

### Metadata Schema
```json
{
  "technical": {
    "duration": 3600.5,
    "resolution": {"width": 1920, "height": 1080},
    "codec": "h264",
    "bitrate": 5000000,
    "fps": 29.97,
    "aspect_ratio": "16:9",
    "audio_codec": "aac",
    "container": "mp4"
  },
  "quality": {
    "tier": "Full HD",
    "score": 85,
    "bitrate_quality": "high",
    "has_artifacts": false
  },
  "scenes": {
    "count": 45,
    "types": ["presentation", "demonstration"],
    "tags": ["tech", "tutorial", "software"],
    "primary_category": "educational"
  }
}
```

### File Locations
- `file_organizer_v2/src/file_organizer/services/video_metadata_extractor.py` - Main metadata service
- `file_organizer_v2/src/file_organizer/utils/quality_analyzer.py` - Quality assessment utilities
- `file_organizer_v2/src/file_organizer/services/scene_categorizer.py` - Scene-based categorization

## Acceptance Criteria
- [ ] Extracts all major technical metadata fields accurately
- [ ] Quality tier classification is correct for various resolutions
- [ ] Quality score correlates with actual video quality
- [ ] Scene-based categorization achieves >80% accuracy
- [ ] Metadata extraction completes in <5 seconds for typical videos
- [ ] Handles corrupted or incomplete video files gracefully
- [ ] Unit tests cover all metadata extraction functions
- [ ] Integration tests verify scene categorization with Task 004

## Testing Strategy
- Unit tests for metadata extraction with sample videos
- Quality assessment validation against known-quality videos
- Scene categorization accuracy tests
- Performance benchmarks for large files
- Error handling tests (corrupted files, missing streams)

## Dependencies
- **Task 004**: Multi-frame video analysis (provides scene frames for categorization)

## Related Tasks
- Task 004: Implement multi-frame video analysis (provides scene data)
- Task 005: Add video transcription (transcript can enhance categorization)

## Estimated Effort
- Size: **M** (Medium)
- Hours: **16**
- Parallel execution: **Yes** (can work independently once Task 004 is complete)

## Notes
- ffprobe must be installed on system for metadata extraction
- Scene categorization accuracy depends on vision model quality
- Consider caching metadata to avoid re-extraction
- Quality assessment heuristics may need tuning for different video types
- Future enhancement: Use transcript (Task 005) to improve categorization accuracy
- Metadata should be stored in database for fast search/filtering
